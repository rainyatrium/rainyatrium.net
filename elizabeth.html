<!DOCTYPE html>
<!-- i preabsolve myself of the sins i will surely commit -->
<!-- 

-->
<html>
  <head>
    <meta property="og:url" content="https://rainyatrium.neocities.org/elizabeth">
    <meta property="og:type" content="website">
    <meta property="og:title" content="--MO-RNING--">
    <meta property="og:description" content="RESULT::'compartmentalized thoughtform';'low dimensional thoughtspace'">
    <meta property="og:image" content="https://rainyatrium.neocities.org/assets/corrulike/elizabeth/dead_room_monochrome.png">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="icon" type="image/x-icon" href="/assets/corrulike/elizabeth/portrait.gif">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <title>IN THE EARLY MO-RNING (OR ELIZABETH OR ENTER UNDERSTUDY OR CONCATENATION OR EUKARYOSIS OR DAWN O'ER ROME, AGAIN)</title>
    <link href="/css/corrulike.css" rel="stylesheet" type="text/css" media="all">
    
    <script src="/js/howler/howler_no.js"></script>
    <script 
    src="https://code.jquery.com/jquery-3.7.1.min.js"
  	integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  	crossorigin="anonymous"></script>
  	<script
			  src="https://code.jquery.com/color/jquery.color-3.0.0.min.js"
			  integrity="sha256-KfnxwOV3FhXN7A/28TCtqslo5fRS23cxO5XcxVO5we8="
			  crossorigin="anonymous"></script>
  
    
      <style>
    @media only screen and (max-width: 800px) {
    .centerContainer {
      min-width:80% !important;
      }
    }
    </style>

  </head>

			  
  <body class = "elizabethBody">
    
    <div class = "debug">
    <span style="font-family:Space Mono;font-size:0.7rem;font-weight:bold"> WHAT?? WHAT ARE YOU DOING IN HERE?? </span>
    <br>
    <span id="clickEventStageGuy"> </span>
    <br><span id="eventBusyStageGuy"> </span>
    <br><span id="modifiersGuy"> </span>
    <br><span id="audioGuy"> </span>
    <br><span class="definition" definition="test"> Definition </span>
    </div>
    
    <div class = "soundControls">
    <!--might be a lot of style redundancy in this. shh-->
      <button id="muteButton" class="muteButton" aria-checked="true">
        <img src="/assets/corrulike/elizabeth/volume.png" style="background:transparent;min-width:100%;max-width:100%;float:left">
      </button>
      <div class="soundControlsDesk" style="min-width:100%;min-height:100%;overflow:clip;transform:translateX(var(--hide-amount))">
        <div class="soundControlsDrawer">
          <div class="soundControlsBehind">
            <div style="min-width:10%"> </div>
            <div id="sliderBG"> </div>
          </div>
          <div style="min-width:10%"> </div>
          <div id="sliderHolder"> 
           <input class="volumeSlider" type="range" id="volume" min="0" max="1" value="1" step="0.01" style="z-index:801">
          </div>
        </div>
      </div>
    </div>

    <div class = "blinds">
      <div class = "blindsBG"> <div class = "blindsNoise"> </div> </div>
      <div class = "blindsWrapper initial">
        <div class = "blindsEntryBox"> 
          <div class = "jittery" style="margin-bottom:10%;font-family:beech;font-size:2rem;color:cyan"> --MOURNING-- </div>
          <div class = "jittery" style="font-family:beech;font-size:1rem;color:magenta"> PROCEED? </div>
        </div>
      </div>
      <div class = "blindsCreditWrapper initial">
        <div class = "blindsCreditBox"> 
          <!--<span style="color:LIME"><b>STILL DECOMPARTMENTALIZING THIS ONE,,, PLEASE RETURN AT A LATER DATE... -- SORTFRIEND</b></span>-->
          <br>this brief remembrance is grown of the world of <a style="color:white" href="https://corru.observer/">corru.observer</a> by <a style="color:white" href="https://corru.works/">corru.works:</a>
          <br> its exploration is recommended prior to advancement
        </div>
      </div>
    </div>
    
     <div class = "poem">
          <div id = "poemBG" style="position:absolute;width:100%;height:100%;z-index:6"> <div class = "blindsBG"> <div class = "blindsNoise">  </div></div> </div>
          <div class = "poemBox">
            <div class = "poemFlex" style > 
              <div class = "poemColumn" style = "padding-left:20%">
                <span class = "floaty">a good maker? yes, i will tell you:</span>
                <br>
                <br><span class = "floaty">a good maker looks above</span>
                <br><span class = "floaty">to velzie and shows it that a play does not have to be a tragedy</span>
                <br><span class = "floaty">and things can be better</span>
                <br><span class = "floaty">and still quite entertaining</span>
                <br>
                <br><span class = "floaty">a good maker looks ahead</span>
                <br><span class = "floaty">and does not lose track of any strand in their mycelium,</span>
                <br><span class = "floaty">not one</span>
                <br><span class = "floaty">a good maker looks behind</span>
                <br><span class = "floaty">to their failures and eats them whole to feed their mind</span>
                <br><span class = "floaty">and those of others</span>
                <br><span class = "floaty">a good maker looks dexter</span>
                <br><span class = "floaty">to their cohorts</span>
                <br><span class = "floaty">for a good maker is not alone</span>
              </div>
              <div class = "poemColumn" style = "padding-right:20%">
                <br><span class = "floaty">because a good maker knows togetherness</span>
                <br><span class = "floaty">and looks sinister at their faults</span>
                <br><span class = "floaty">that are not faults but scaffolds</span>
                <br><span class = "floaty">for others to grow along and thus reinforce</span>
                <br>
                <br><span class = "floaty">and a good maker does not see an ending and starve like a celki lost grip of its veilk, no;</span>
                <br><span class = "floaty">a good maker sees an ending and</span>
                <br><span class = "floaty">togetherness will make it not so much</span>
                <br><span class = "floaty">an ending after all</span>
                <br>
                <br><span class = "floaty">a good maker looks sinister and dexter and behind and ahead and above</span>
                <br><span class = "floaty">and a good maker looks below</span>
                <br><span class = "floaty">and sees the substrate they have grown from and gladly kneels to be</span>
                <br><span class = "floaty">the medium by which the next maker</span>
                <br><span class = "floaty">(whose receptors are still of velvet)</span>
                <br><span class = "floaty">will grow to look in directions that have yet to be conceived,</span>
                <br><span class = "floaty">and that is a good maker.</span>
                <br><span class = "floaty">you see now?</span>
                <br><span class = "floaty">that is a good maker.</span>
              </div>
            </div>
          </div>
    </div>
    
    <div class = "gridWrapper">
      <div class = "deadRoom"></div>
      <div class = "noiseLayer" style="image-rendering:pixelated"></div>
      <div id = "hideLayer" style="position:absolute;width:100%;height:100%;z-index:-1"> <div class = "blindsBG"> <div class = "blindsNoise">  </div></div></div>
      <div class = "centerContainer clickAdvance" id="autoScrollable">
        <div class="imageBase" style="z-index:2">
          <img src="/assets/corrulike/elizabeth/dead_room.gif" alt="home" title="home" style="max-width:100%">
          <img class="imageExtra" src="/assets/corrulike/elizabeth/eyes_blink_1.gif" alt="home" title="home" style="max-width:100%">
          <img class="imageExtra" src="/assets/corrulike/elizabeth/eyes_blink_2.gif" alt="home" title="home" style="max-width:100%"> 
          <img class="imageExtra" src="/assets/corrulike/elizabeth/eyes_fade_out_1.gif" alt="home" title="home" style="max-width:100%">
          <img id = "EyeOpeningExperience" class="imageExtra" src="/assets/corrulike/elizabeth/EYEOPENINGEXPERIENCE/EYE1.png" alt="home" title="home" style="max-width:100%">
        </div>
        
        <div class = "textContainer">
        <div id="contentDiv"> </div>
        </div>
        </div>
    </div>
    
   
    <div id="definition-box"></div>
    
    
    <!--dragons below this point. a lot to clean up but when i extract all these systems from this project they will be rewritten anyway so i consider this 'good enough' for a short experience -->
    <!--BLINDS-->
    <script>
    //DEBUG COUNTERS
    function DEBUG(){
      let debug = false;
      document.addEventListener("keydown", keyPress);
      function keyPress(e) {
        //console.log(e.key);
        if (e.key == "`") {
          if (!debug) {
              debug = true; 
              document.querySelector(".debug").style.display = "inline"
              setInterval(function(){
              document.getElementById("clickEventStageGuy").innerHTML= 'stage:' + clickEventStage; //update debug counter
              document.getElementById("eventBusyStageGuy").innerHTML= 'busy? ' + isBusy; //update debug counter
              document.getElementById("modifiersGuy").innerHTML= JSON.stringify(dialogueModifiers); //update debug counter
              document.getElementById("audioGuy").innerHTML= 'currentAudio: ' + currentAudio[1] + '|' + currentAudio[2]; //update debug counter
            }, 40)      
          } else {
              debug = false;
              document.querySelector(".debug").style.display = "none"
          }
          }
        //also enter to advance. because what is organization?
        if (e.key == "Enter") {
           if (document.querySelector(".gridWrapper").style.display != "none") {
                       clickAdvance();
           }
        }
      }
    }
    
    //hide bulk of the page until we need it (to avoid 'spoiler' silliness from neocities loading assets slow)
    document.querySelector(".gridWrapper").style.display = "none";
    document.querySelector(".poem").style.display = "none";
    //now that everything is loaded, we can start all our shit and let the user Proceed...
    window.onload = function() {
    DEBUG();
    corruHoverText();
      //this stuff starts after they click forward
      document.querySelector(".blindsEntryBox").addEventListener('click',clickedInit);
        function clickedInit() {
          document.querySelector(".gridWrapper").style.display = "grid"; //re-enable the main page contents
          soundInit();
          let blinds = document.querySelector(".blinds");
          blinds.animate([{opacity:1,},{opacity:0},],{duration:400,fill:"forwards"});
          //hide the blinds & hide the welcome messages (so we can bring back the blinds when we leave later)
          Promise.all(blinds.getAnimations().map((animation) => animation.finished)).then(
            () => blinds.style.display = "none",
            );
        }
    }
    
   
    </script>
    
    <!-- DIALOGUE/STAGES (learning experience)... the next one will be more sane -->
    <script>  
     let clickEventStage = -1; //stage
     let isBusy = false; //are we typing dialogue
     let skipping = false; //this is what tells the typing function to skip to the end
     let clickAdvancers = document.getElementsByClassName("clickAdvance"); //areas the user can click to advance stage
     for(let i= 0; i < clickAdvancers.length; i++) {
       clickAdvancers[i].addEventListener('click',clickAdvance);
     }
     let stageArray; //this is where we will store all our events and things when we retrieve them
      $.get('assets/corrulike/elizabeth/stages.txt', function(data){
        /*hm. maybe lines in [] can be modifiers that are taken into account as they come up? this works better for things like multiple
        characters in other projects.*/
        let stageLines = data.split("\n");
        //ignore comments
        for(let i= 0; i < stageLines.length; i++) {
          if (stageLines[i].startsWith("//")) {stageLines.splice(i,1)}; 
        }
        stageArray = stageLines;
      });
        
    //TYPING
      const printSentence = (id, sentence, speed) => {
        let index = 0;
        let scrollCounter = 0;
        let element = document.getElementById(id);
      
        let timer = setInterval(function() {
            isBusy = true;
            const char = sentence[index];
            
            if (char === '<') {
              index = sentence.indexOf('>', index);  // skip to greater-than
            }
            
            //If skipping is true, then skip to the end of the sentence
            if (skipping == false) { 
              element.innerHTML = sentence.slice(0, index);
              } else { 
              element.innerHTML = sentence.slice(0, sentence.length); 
              index = sentence.length-1;
              skipping = false;
              }
            function scrollBottom() {
            document.getElementById("autoScrollable").scrollTo({
            top:  document.getElementById("autoScrollable").scrollHeight,
            behavior: 'smooth',
            })
            }
            //Scroll to the bottom 
            //modulo so that it does not get jittery outside firefox
            scrollCounter++;
            if (scrollCounter % 10 === 0) {
              scrollBottom()
            }
    
            if (++index === sentence.length) {
              scrollBottom()
              isBusy = false;
              clearInterval(timer);
            }
          }, speed);
        } 
      
    //DIALOGUE MODIFIERS
    //format in stages.txt (this might be silly)
    //[css::"a"||textspeed::0||audiospeed::1]
      let dialogueModifiers = {
        css: null,
        nodiv: false,
        textspeed: 40,
        audiospeed: 1,
        audiopitch: 1,
        audiotrack1: 1,
        audiotrack2: 0,
        audiotrack3: 0,
        audiotrack4: 0,
        runfunction: null,
      }
      
    //ON CLICK
      function clickAdvance() {

      //only try to move forward if we have finished parsing the stages.txt
      if (stageArray != null) {
      nextSound.play() //in the future this should be tweakable via dialogue modifiers. play dialogue sound
      
      //set skip to true if the player tries to click during typing, otherwise run the next line and advance stage
      if (isBusy == true) {
        skipping = true;
      } else {
        clickEventStage++;
        //if the line starts with [, it has modifiers; let's set those values
        if (stageArray[clickEventStage].startsWith("[")) {
          let pairs = stageArray[clickEventStage].slice(1,-1).split('||');
          //this exact line is when i learned about for...of. (7.24.2024, 5:36AM), *snaps photograph with my polaroid camera*
          for (const pair of pairs) {
            let [key, value] = pair.split('::');
            //if the key matches any keys in dialogueModifiers, set it
             for (modKey of Object.keys(dialogueModifiers)) {
              if (modKey == key) {
                dialogueModifiers[modKey] = value;
                }
             }
           }
           clickEventStage++; //skip to the next line
         }; 
                  
        //set audio properties
        for (let i = 1; i < audioTracks.length; i++) {
        ratween(audioTracks[i], dialogueModifiers.audiospeed);
        }
        //if we have a function to run, run it and then reset runfunction
        if (dialogueModifiers.runfunction != null) {
          let runfunction = dialogueModifiers.runfunction;
          window[runfunction]();
          dialogueModifiers.runfunction = null;
        }
         
        //Then call our typing function
        // ONE LINE AT A TIME/SIMPLE: printSentence('contentDiv',stageArray[clickEventStage],0);
        // STACK LINES/CORRU-LIKE
        if (dialogueModifiers.nodiv != "true") {
        let dialogueBox = document.createElement("div");
        dialogueBox.className = "dialogueBox";
        dialogueBox.style.cssText = dialogueModifiers.css;
        dialogueBox.id = "dialogue"+clickEventStage;
        document.getElementById("contentDiv").appendChild(dialogueBox);
        printSentence(dialogueBox.id,stageArray[clickEventStage],dialogueModifiers.textspeed)
        } else {dialogueModifiers.nodiv = true};
      }
      }
     }
    </script>
    
    <!-- SOUND -->
    <script>
    //i hate monkeys. so much. so this is gonna get hardcoded and then in the next project when i rewrite everything this can become adaptable on the fly. maybe use something that is not howler
    //also howler fucking SCREAMS every time i load the page even though i am not doing anything before user interaction which i have no clue what is happening there
    //future plans: another txt file with sound configs including each track, default volume, etc. rather than doing it in the html (and spread weirdly like here) i like organizing that way. maybe it can share a file with stages.txt?
    
    //start sound stuff
    //set all tracks to fade in in 1000ms by default

    function soundInit(){
      callSound.on('play',function() {callSound.fade(0,0.1,24000)});
      for (let i = 1; i < audioTracks.length; i++) {
          audioTracks[i].on('play',function() {audioTracks[i].fade(0,1,4700)});
      }
      
      //background static to cover for howler's abysmal looping
      staticSound.play();
      
      //for now default track is set here and it will be the first one in the array. also set ms length for closer transitions.
      //this will not be perfect but it is Fine for this particular project i guess. better loop next time
      //THIS IS A MESS AND LOTS IS HARDCODED. TO BE REBUILT FROM GROUND UP FOR THE NEXT TIME
      let audioProperties = {
        defaultaudio1: 1,
        defaultaudio2: 0,
        defaultaudio3: 0,
        defaultaudio4: 0,
        barlength: 4800,
      }
      if (!audioTracks[audioProperties.defaultaudio1].playing()) {
        audioTracks[audioProperties.defaultaudio1].play();
      }
      currentAudio[1] = audioProperties.defaultaudio1;
      currentAudio[2] = audioProperties.defaultaudio2;
      currentAudio[3] = audioProperties.defaultaudio3
      currentAudio[4] = audioProperties.defaultaudio4;
      //every bar, check if the audio has changed. if it has, swap them out at the next opportunity
      setInterval(function() {
        for (let i = 1; i <= 4; i++) {
            //let modifierTrack = window[${dialogueModifiers.audiotrack}${i}];
            modifierTrack = dialogueModifiers['audiotrack'+i];
            if (lastAudio[i] != null && audioTracks[lastAudio[i]].playing()) {audioTracks[lastAudio[i]].stop();};
            if (modifierTrack != currentAudio[i]) {
              //stop last audio
              //fade in new audio
              audioTracks[modifierTrack].play();
              //fade out current audio
              howlFade(audioTracks[currentAudio[i]],audioTracks[currentAudio[i]].volume(),0);
              //mark the audio we just faded out as last audio, to stop it next measure
              lastAudio[i] = currentAudio[i];
              //set current audio to the newly playing audio
              currentAudio[i] = modifierTrack;     
            }   
        }
      }, audioProperties.barlength/dialogueModifiers.audiospeed);
    }
    
    function howlFade(howl, from, to, duration = 4700) {
      howl.fade(from, to, duration);
    }
    
    //our sound effects. see first comment
      let currentAudio  = new Array();
      let lastAudio = new Array();
      let audioTracks = new Array();
      //0 is silence
      audioTracks[0] = new Howl({
      src: ['...'],
        html5: false,
        loop: true,
      });
      audioTracks[1] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/wawuwa harder.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[2] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/drums harder.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[3] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/POEM SOLO.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[4] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/marimba harder2.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[5] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/tension final.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[6] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/lowbass harder.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[7] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/marimba harder machine2.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[8] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/real lowbass.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[9] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/machine background.ogg'],
        html5: false,
        loop: true,
      });
      audioTracks[10] = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/no instruments.ogg'],
        html5: false,
        loop: true,
      });
      callSound = new Howl({
      src: ['https://corru.observer/audio/collapsesignal.ogg'],
        html5: false,
        loop: true,
        onstart: function() {callSound.fade(0,0.1,24000)},
      });
      nextSound = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/next.mp3'],
        html5: false,
        loop: false,
        volume: 0.4,
      });
      panicSound = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/panc end.ogg'],
        html5: false,
        loop: false,
        volume: 1,
      });
      knockOnce = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/knock once.ogg'],
        html5: false,
        loop: false,
        volume: 0.7,
      });
      knockTwice = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/knock twice.ogg'],
        html5: false,
        loop: false,
        volume: 1,
      });
      staticSound = new Howl({
      src: ['https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/static.ogg'],
        html5: false,
        loop: true,
        volume: 0,
        onstart: function() {staticSound.fade(0,1,2400)},
      });

      
    //this is literally just corru's function
    function ratween(howl, desiredRate, duration = 4700) {
                if(!desiredRate) return console.warn(`got passed ${desiredRate} in ratween, invalid! howl:`, howl);
          try {
              let startingRate = howl.rate()
              if(startingRate == desiredRate) return
      
              //split the duration into 50ms chunks and execute them
              let stepLength = 50
              let steps = duration / stepLength
              for (let i = 1; i < (steps + 1); i++) {
                  setTimeout(()=>{
                      howl.rate(startingRate + ((i/steps) * (desiredRate - startingRate)) || 1)
                  }, stepLength * i)
              }
          } catch(e) { printError(e) }
      }
      
    //volume control
    let volumeKeep = 1;
    const sliderHolder = document.getElementById("sliderHolder");
    const volumeControl = document.querySelector("#volume");
    const muteButton = document.getElementById('muteButton');
    const volumeUnmuteImg = "/assets/corrulike/elizabeth/volume.png";
    const volumeMuteImg = "/assets/corrulike/elizabeth/volume_mute.png";
    
    function setMuted() {
        volumeControl.value = 0;
        Howler.volume(0);
        $(sliderHolder).css("mask-size","0% 100%")
        muteButton.querySelector('img').src = "/assets/corrulike/elizabeth/volume_mute.png";
        muteButton.setAttribute("aria-checked","false");
    }
    function setUnMuted() {
        volumeControl.value = volumeKeep;
        Howler.volume(volumeKeep);
        $(sliderHolder).css("mask-size",String(volumeKeep * 100) + "% 100%")
        muteButton.querySelector('img').src = "/assets/corrulike/elizabeth/volume.png";
        muteButton.setAttribute("aria-checked","true"); 
    }
        
    muteButton.addEventListener('click', () => {
      if (muteButton.getAttribute("aria-checked") === "true") {
        setMuted();
      } else {
        setUnMuted();
        }
      })
      
       
    volumeControl.addEventListener(
      "input",
      () => {
      volumeKeep = volumeControl.value;
      Howler.volume(volumeControl.value);
      muteButton.querySelector('img').src = "/assets/corrulike/elizabeth/volume.png";
      muteButton.setAttribute("aria-checked","true");
      $(sliderHolder).css("mask-size",String(volumeControl.value * 100) + "% 100%")
      if (volumeControl.value <= 0) {
        setMuted();
        }
      
      },
      false,
    );

    </script>
    
    <!-- FUCK YOU FINE I WILL FIND ANOTHER WAY!!!!! FUCK!! -->
    <script>
    //in lieu of a working library (thanks tippy): thievery. no but really, this is corru's hover text. 
    //thank you apia for breaking it down for me!!
    //env
    var env = {
      cursor: {x:0, y:0}, //fixed coords
      pageCursor: {x:0, y:0}, //page coords
      defbox: document.getElementById('definition-box')
    };
    //track mouse
    window.addEventListener('mousemove', e=> {
        if (env.mouseThrottle) {
            return
        }
        env.cursor.x = e.clientX
        env.cursor.y = e.clientY
        
        env.pageCursor.x = e.pageX
        env.pageCursor.y = e.pageY
        
        if(!env.temporaryOptimize) { // limited during sensitive sequences, i.e. bullet hells
            env.defbox.style.setProperty("--x", env.cursor.x)
            env.defbox.style.setProperty("--y", env.cursor.y)

            if(typeof env.mouseMove == "function") env.mouseMove() //can be set up per page or per needs as to not need to manage page-internal mousemoves
        }

        env.mouseThrottle = true
        setTimeout(()=>env.mouseThrottle = false, env.mouseThrottleSpeed)
    })
    //hovertext
    function corruHoverText() {

      
      
      /*a bunch of times a second, check to see if...
      * 1) they're hovering over a target and the MUI is on - stores targets for a variety of fun activities
      * 2) they're hovering over an element with a definition - moves the definition box to the mouse, updates its text, and adds an active class
      */
      env.hoverIntervalRate = 100
      env.hoverFunc = () => {
          //definition tracking
          let hovering = document.elementFromPoint(env.cursor.x, env.cursor.y)
  
          if(hovering) {
              if(hovering.hasAttribute('definition')) {
                  //flip the position of the transform based on which side of the screen it's on
                  if(env.cursor.x < (window.innerWidth / 2)) env.defbox.style.setProperty("--xFlip", 0); else env.defbox.style.setProperty("--xFlip", -1)
                  if(env.cursor.y < (window.innerHeight / 2)) env.defbox.style.setProperty("--yFlip", 0); else env.defbox.style.setProperty("--yFlip", -1)
  
                  env.defbox.classList.add('active')
  
                  env.defbox.innerText = hovering.getAttribute('definition')
              } else {
                  env.defbox.classList.remove('active')
              }
          }
      }
      env.hoverInterval = () => {
          setTimeout(()=>{
              env.hoverFunc()
              env.hoverInterval()
          }, env.hoverIntervalRate)
      }
      env.hoverInterval()
    }
    </script>
    
    <!-- TEXT FX -->
    <script>
    //indecisive
      let corroyi = false
      let indecisives = document.getElementsByClassName("indecisive");
  
      function indecisive() { 
        for(let i= 0; i < indecisives.length; i++) {
          if (Math.random() >= 0.5) {
          indecisives[i].innerHTML = "blood";
          } else {
          indecisives[i].innerHTML = "corroyi";
          }
        }    
      }
      let t=setInterval(indecisive,40);  
    //jitter
    //i would rather have this be one function i can put in parameters for. adding to the list 
    jitter();
    function jitter() {
      let jitters = document.getElementsByClassName("jittery");
      //cut up our words into individual letter spans
      for(let i=0; i < jitters.length; i++) {
        let slice = jitters[i].textContent.split('');
        let letters= "";
        for (let i=0; i < slice.length; i++) {
          letters += '<span>' + slice[i] + '</span>';  
        }
        //and put them back
        jitters[i].innerHTML = letters;
        //now mix up the timing
        let jitterySpans = jitters[i].getElementsByTagName('span');
        for (let i=0; i < jitterySpans.length; i++) {
          let randomDelay = Math.random()*70;
          jitterySpans[i].style["animation-delay"] = "-"+randomDelay+"ms";
        }
      }
    }
    
    //POEM EFFECTS
    function POEMEFFECTS() {
      console.log('poem stuff initialized');
    poem();
    $(document).ready(function () {
    $('.poemColumn').vortex();
    });
    }
    function poem() {
      let floaters = document.getElementsByClassName("floaty");
      //cut up our words into individual letter spans
      for(let i=0; i < floaters.length; i++) {
        let slice = floaters[i].textContent.split(/(\s+)/);
        let letters= "";
        for (let i=0; i < slice.length; i++) {
          //console.log(slice[i]);
          letters += '<span class="poemSpan">' + slice[i] + '</span>';  
        }
        //and put them back
        floaters[i].innerHTML = letters;
        //now mix up the timing
        let floatySpans = floaters[i].getElementsByTagName('span');
        for (let i=0; i < floatySpans.length; i++) {
          let randomDelay = Math.random()*70;
          floatySpans[i].style["animation-delay"] = "-"+i*100+"ms";
          
          setInterval( function() {
              let rand = Math.random();
              if (rand > 0.997) {floatySpans[i].animate([{color:"cyan"},{color:"#333333"},],{duration:rand*10000,fill:"forwards"});
            }}, 3000);
          setInterval( function() {
              let rand = Math.random();
              if (rand > 0.997) {floatySpans[i].animate([{color:"cyan"},{color:"#333333"},],{duration:rand*10000,fill:"forwards"});
            }}, 1000);
        }
      }
    }
    
    //translated text goes back to normal
    

      //THANK YOU STACKOVERFLOW https://stackoverflow.com/questions/11055696/how-can-i-select-all-elements-within-a-given-radius-from-a-point
    (function(a){var b=a([1]);a.fn.each2=function(d){var c=-1;while((b.context=b[0]=this[++c])&&d.call(b[0],c,b)!==false){}return this}})(jQuery);(function(b,c){function a(g,s,f){g||(g="div");var i=b(g),n=[],p=!!s.furthest,l=!!s.checkHoriz,j=!!s.checkVert,d=p?0:Infinity,r=parseInt(s.x,10)||0,q=parseInt(s.y,10)||0,m=parseInt(r+s.w,10)||r,k=parseInt(q+s.h,10)||q,e=!!b.fn.each2,h=Math.min,o=Math.max;if(!s.includeSelf&&f){i=i.not(f)}i[e?"each2":"each"](function(I,L){var u=e?L:b(this),N=u.offset(),A=N.left,z=N.top,B=u.outerWidth(),J=u.outerHeight(),K=A+B,t=z+J,P=o(A,r),G=h(K,m),v=o(z,q),O=h(t,k),F=G>=P,E=O>=v,D=F?0:P-G,C=E?0:v-O,H=F||E?o(D,C):Math.sqrt(D*D+C*C),M=p?H>d:H<d;if((l&&j)||(!l&&!j&&F&&E)||(l&&E)||(j&&F)){if(M){n=[];d=H}if(H==d){n.push(this)}}});return n}b.each(["nearest","furthest","touching"],function(e,d){var f={x:0,y:0,w:0,h:0,furthest:d=="furthest",includeSelf:false,checkHoriz:d!="touching",checkVert:d!="touching"};b[d]=function(h,g,i){if(!h||h.x===c||h.y===c){return b([])}var j=b.extend({},f,h,i||{});return b(a(g,j))};b.fn[d]=function(g,h){var j;if(g&&b.isPlainObject(g)){j=b.extend({},f,g,h||{});return this.pushStack(a(this,j))}var k=this.offset(),i={x:k.left,y:k.top,w:this.outerWidth(),h:this.outerHeight()};j=b.extend({},f,i,h||{});return this.pushStack(a(g,j,this))}})})(jQuery);

  (function ($) {
    'use strict';

    $.fn.vortex = function (radius) {
        if (radius === undefined) {
            radius = 100;
        }

        var radiusSquared = Math.pow(radius, 2),
            diameter = radius * 2,
            $previouslyChanged = $();

        //$(this).html($(this).text().replace(/(\S+)/g, '<span class="vortext">$1</span>'));

        $(document).mousemove(function (event) {
            var willChange = [];

            $('.poemSpan').nearest({
                x: event.pageX - radius,
                y: event.pageY - radius,
                w: diameter,
                h: diameter
            }).filter(function () {
                var $element = $(this),
                    coordinates = $element.offset(),
                    height = $element.height(),
                    width = $element.width(),
                    left = coordinates.left - event.pageX,
                    top = coordinates.top - event.pageY;

                // broken up for readability (sorry for the duplicate code?)
                if (Math.pow(left, 2) + Math.pow(top, 2) <= radiusSquared) {
                    willChange.push(this);
                    return true;
                }
                if (Math.pow(left + width, 2) + Math.pow(top, 2) <= radiusSquared) {
                    willChange.push(this);
                    return true;
                }
                if (Math.pow(left + width, 2) + Math.pow(top + height, 2) <= radiusSquared) {
                    willChange.push(this);
                    return true;
                }
                if (Math.pow(left, 2) + Math.pow(top + height, 2) <= radiusSquared) {
                    willChange.push(this);
                    return true;
                }
                return false;
            });
            $previouslyChanged.removeClass('vortexed');
            //$previouslyChanged.addClass('vortexTranslated');
            $previouslyChanged = $(willChange).addClass('vortexed');
  
            
        });
    };


}(jQuery));
    </script>
    
    <!-- SPECIAL EVENT FUNCTIONS (FOR STAGES.TXT) -->
    <script>
    function eyeOpeningExperience() {
      let eyeImg = document.getElementById("EyeOpeningExperience");
      eyeImg.src = "/assets/corrulike/elizabeth/EYE_FINAL.gif" 
    }
    function revealRoom() {
      let hideLayer = document.getElementById("hideLayer");
      hideLayer.animate([{opacity:1,},{opacity:0},],{duration:400,fill:"forwards"});
    }
    function revealPoem() {
      panicSound.play();
      playKnockTwice();
      POEMEFFECTS();
      let trackVol = audioTracks[5].volume();
      audioTracks[5].fade(trackVol,0,13550);
      setTimeout(function(){
        audioTracks[5].stop()
        dialogueModifiers.audiotrack1 = 0;
        },14000);
      let poemLayer = document.querySelector(".poem");
      let poemContents = document.querySelector(".poemFlex");
      let gridWrapper = document.querySelector(".gridWrapper");
      document
      poemContents.style.opacity = 0;
      poemLayer.style.opacity = 0;
      poemLayer.style.display = "inline";
      setTimeout(function(){poemLayer.animate([{opacity:0,},{opacity:1},],{duration:1000,fill:"forwards"});},0);
      setTimeout(function(){gridWrapper.animate([{opacity:1,},{opacity:0},],{duration:1000,fill:"forwards"});},0);
      setTimeout(function(){poemContents.animate([{opacity:0,},{opacity:1},],{duration:14000,fill:"forwards"});},4000);
      //gridWrapper.style.opacity = 0.5;
      
      //gridWrapper.animate([{opacity:1,},{opacity:0},],{duration:500,fill:"forwards"});
      //gridWrapper.style.display = "none"
      //poemLayer.animate([{opacity:0,},{opacity:1},],{duration:500,fill:"forwards"});

      //setTimeout(function(){gridWrapper.animate([{opacity:1,},{opacity:0},],{duration:500,fill:"forwards"});
      //setTimeout(function(){gridWrapper.style.display = "none"},505);
      
    }
    
    function startCall() {
      audioTracks[4].fade(1,0,24000);
      setTimeout(function(){dialogueModifiers.audiotrack1 = 1},23980);
      callSound.play()
    }
    function endCall() {
      let callVol = callSound.volume();
      callSound.fade(callVol,0,3000);
     setTimeout(function(){callSound.stop()},3000);
    }
    function endPanic() {
      panicSound.play();
      audioTracks[2].stop;
    }
    function playKnockOnce() {
      knockOnce.play();
    }
    function playKnockTwice() {
      knockTwice.play()
    }
    </script>
    
    <!-- JUNK -->
    <script>
          
      //in which "an spider" fights "King Kong" and nobody fucking wins
      /*const filter = Howler.ctx.createBiquadFilter()
        filter.type = 'lowpass'
        filter.frequency.setTargetAtTime(8000, Howler.ctx.currentTime, 0)
        Howler.ctx.destination.disconnect()
        Howler.masterGain.disconnect(Howler.ctx.destination)
        Howler.masterGain.connect(filter).connect(Howler.ctx.destination)
        //loop:true,
        //preload: false
      
      //console.log(mainTrack._sounds[0])
  
      //const sound_node = mainTrack._sounds[0]._node // This is a gain node
      //sound_node.disconnect(Howler.masterGain)
        
      //const streamOutput = Howler.ctx.createMediaStreamDestination();
      //sound_node.connect(filter)*/
    /*<!-- webaudio version <audio crossorigin="anonymous">
    <source src="https://file.garden/ZoN1rXu7yCSIGDyL/neocities/elizabeth/elizabeth_true.mp3" type="audio/mp3"/>
    </audio>
    <div class = "soundControls">-->
    <!-- but let's try howler -->*/

    </script>

  </body>

</html>
